# 📦 Патчноуты

---

## 🐛 Version 3.0.4

### 🐛 Bug Fixes (macOS)
- Fixed: "damaged and can't be opened" error — the app inside the DMG is now ad-hoc signed before the DMG is assembled.
- Fixed: Signing order is now correct: `package → sign → make DMG`.
- Note: macOS still shows an "unidentified developer" prompt. Right-click the app → **Open** → **Open Anyway**.

---

## 🆕 Версия 2.5.1

### 🆕 Новая функция: Giant Tracker
Отдельное окно в плагине Killfeed — собирает и визуализирует статистику убийств для **Giants**, **Violets** и **Bosses**.

**Вкладки фильтра**
- 5 вкладок: **Все** · **Giants** · **Violets** · **Bosses** · **Drops**
- **Bosses** — фильтрация по рангу `boss` (красная рамка карточки, отдельный стиль иконок)
- **Drops** — показывает только монстров с зафиксированными дропами, включая превью пула лута (топ-5 предметов по редкости) прямо в карточке

**Статистика убийств**
- Карточный вид с режимами Compact и Expanded
- Периоды: Сегодня, Неделя, Месяц, Год, Всего
- Информация о монстре: иконка, имя, уровень, элемент, ранг, HP, ATK

**Отслеживание дропов**
- Логирование дропов из loot pool монстра (с фильтром редкости)
- История дропов по каждому монстру: название предмета, значение счётчика убийств, метка времени
- Статистика: Ø убийств/дроп, убийств с последнего дропа

**Time to Kill (TTK)**
- Автоматически измеряет длительность боя с Giants, Violets и Bosses
- 10-секундный льготный период при снятии цели (баф, лечение и т.д.) — время паузы не включается в TTK
- Отпечаток имени монстра + max HP: цель надёжно распознаётся повторно
- Отображение: Последний TTK, Ø TTK, Самый быстрый
- Сохраняется в истории убийств (столбец CSV `TTK_ms`)

**Прочее**
- Сортировка по количеству убийств, имени или уровню
- Поле поиска для фильтрации по имени монстра

### ✨ Дополнительные улучшения
- Killfeed: улучшено распознавание монстров
- Новые веса идентификации: HP монстра > Уровень монстра > Элемент монстра
- Killfeed: трекинг монстров теперь считает убитых мобов
- Killfeed: добавлена история (по профилям)
  - Ежедневный файл по дате с отдельными убийствами (`Дата/Время`, `Персонаж`, `Уровень`, `Monster-ID`, `Ранг`, `Монстр`, `Элемент`, `Прирост EXP`, `Ожидаемый EXP`, `TTK_ms`)
  - Агрегированная дневная сводка с `Kills`, `EXP всего`, `Распределением монстров`, `Первым/Последним убийством`
- Killfeed: трекинг монстров в боковой панели теперь обновляется сразу после убийств (без переключения вкладок)
- Killfeed: в аккордеонах трекинга монстров теперь есть кнопка Kills для каждого ранга с ListView отдельных убийств.
  Отдельные убийства можно удалять прямо в ListView.
  При удалении отдельных убийств обновляются файлы истории AppData (daily/YYYY-MM-DD.csv, history.csv) и состояние боковой панели.
- Killfeed: боковая панель теперь стабильно следует за целевым профилем оверлея (без прыжков между ID профилей)
- Обновлены справочные данные монстров
- Оптимизирован дизайн диалога "Выбрать макет"
- Оптимизирован дизайн диалога "Управление профилями (выход)"

### 🐛 Исправления
- Оверлеи больше не перекрывают диалог закрытия
- Аккордеоны в документации отображаются корректно
- Миграция с версии 2.3.0 на новую структуру AppData (`user/`) теперь работает надёжно
- Killfeed: отрицательные скачки OCR EXP теперь отфильтровываются как шум OCR и больше не искажают определение убийств

### 🧹 Чистка
- Архитектура рендера модульно переработана (внутренняя реструктуризация)
- Внутренняя папка данных `api_fetch/` переименована в `cache/`
- Структура каталога AppData реорганизована: данные теперь отсортированы в подпапке AppData\Roaming\Flyff-U-Launcher\user
- Автоматическая миграция: существующие данные плавно переносятся при первом запуске — с индикатором прогресса
- Статические данные (в т.ч. справочные) включаются в build, чтобы надёжно быть доступными в release-сборках
- Уменьшен объём debug-логов Killfeed/overlay, чтобы консоль оставалась более читаемой

:::accordion[Новые пути хранения]
Все пользовательские данные теперь находятся в `%APPDATA%\Flyff-U-Launcher\user\`:

- `user/config/settings.json` — Настройки клиента
- `user/config/features.json` — Флаги функций
- `user/profiles/profiles.json` — Профили лаунчера
- `user/profiles/rois.json` — Калибровки ROI
- `user/profiles/ocr-timers.json` — OCR-таймеры
- `user/ui/themes.json` — Темы
- `user/ui/tab-layouts.json` — Макеты вкладок
- `user/ui/tab-active-color.json` — Цвет активной вкладки
- `user/shopping/item-prices.json` — Цены списка премиум-покупок
- `user/plugin-data/` — Настройки плагинов
- `user/plugin-data/killfeed/history/<profile-id>/history.csv` — Дневная сводка Killfeed по профилю
- `user/plugin-data/killfeed/history/<profile-id>/daily/YYYY-MM-DD.csv` — Детальная история Killfeed по каждому убийству и дню
- `user/cache/` — Данные API fetch и иконки
- `user/logs/` — Диагностические логи
:::

---

## 🆕 Версия 2.3.0

### 🐛 Исправления

- Значения OCR (боковая панель) теперь корректно считываются, когда игра запущена в отдельном мультиоконном сеансе
- Калибровка ROI больше не открывает ошибочно новый сеанс, а использует существующее игровое окно
- OCR теперь надёжно использует встроенный Tesseract — отдельная установка больше не требуется

### ✨ Улучшения

- Аккордеоны документации теперь используют нативные элементы HTML5 (JavaScript больше не требуется)

---

## 🆕 Версия 2.2.0

### ➕ Новые функции

**Макеты**
- Переработана функция макетов, поддерживаемые схемы отображения игры:
  - 1x1 одиночное окно
  - 1x2 разделённый экран
  - 1x3, 1x4, 2x2, 3+2, 2x3, 4+3, 2x4 мультиэкраны
- В панель вкладок добавлена полоса прогресса, показывающая открытие игровых экранов
- Система мультиокон: можно открыть несколько независимых окон сессии

**Горячие клавиши** — свободно назначаемые комбинации (2–3 клавиши)
- Скрыть оверлеи
- Боковая панель вкл/выкл
- Панель вкладок вкл/выкл
- Сохранить скриншот активного окна в `C:\Users\<USER>\Pictures\Flyff-U-Launcher\`
- Предыдущая вкладка / Следующая вкладка
- Следующий экземпляр окна
- Сбросить CD-таймер на 00:00, иконки ждут клика
- Открыть калькулятор FCoins
- Открыть премиум-лист покупок

**Новые настройки клиента**
- Ширина / высота лаунчера
- Последовательная загрузка вкладок сетки
- Отображение вкладок для макетов
- Подсвечивать активный grid-view
- Обновлять макеты при изменениях
- Длительность статусных сообщений
- Курс обмена FCoins
- Режим отображения макетов вкладок (Компактный, Групповой, Раздельный, Мини-grid)

**Меню и инструменты**
- Новое меню «Tools (звезда)» в панели вкладок.
  Меню скрывает браузерное окно, персонажи остаются в игре.
  - Внутренние инструменты: конвертер FCoins → Penya, премиум-лист покупок
  - Внешние ссылки: Flyff Universe, Flyffipedia, Flyffulator, Skillulator
- Новое меню в панели вкладок (иконка клавиатуры) показывает заданные горячие клавиши.
  Меню скрывает браузерное окно, персонажи остаются в игре.

**Документация**
- Новая вкладка «Документация» в настройках с описаниями на разных языках:
  - Создать профиль, создать макет, пути данных и постоянство, API fetch,
    CD-таймер, killfeed, FCoins <-> Penya, премиум-лист покупок
- Текст переведён на все доступные языки, часть изображений пока отсутствует.
  Фолбэк: английский UI → немецкий UI.

**Прочее**
- Добавлена новая тема «Steel Ruby»
- Лаунчер показывает под новостной лентой список уже открытых профилей
- В Настройки → Поддержка добавлена возможность доната
- В диалоге закрытия для мультивкладок появилась опция «Разделить на отдельные вкладки»
- При открытии профиля, когда сессия уже активна, спрашивается добавить его в текущее окно или создать новое

### 🧹 Чистка

- Окно лаунчера теперь имеет минимальный размер и остаётся адаптивным до этого порога
- Размер окна по умолчанию изменён с 980×640 на 1200×970
- В меню настроек добавлена кнопка «X»
- Подправлен размер окна настроек
- Изменено меню «Manage» для профилей и макетов. Теперь там «Переименовать» и «Удалить»
- В выбор макета добавлена кнопка «Профиль», показывающая профили в макете
- Добавлена иконка для кнопки увеличения панели вкладок
- Активная вкладка выделена в диалоге закрытия

### 🐛 Исправления

- Исправлена ошибка, из-за которой при переключении вкладок игра скрывалась

### 🐛 Известные проблемы

- Иногда ввод текста в боковой панели приходит некорректно
- Оверлеи отображаются в диалогах, например «Закрыть» и «Выбрать макет» — исправлено в 2.4.1 ✅
- Боковая панель не отображается в оконном режиме


---

## 🆕 Версия 2.1.1

### ✨ Улучшения

- Оверлеи больше не перекрывают внешние окна.
  Когда окно неактивно, они автоматически скрываются.
- Исправлено мерцание оверлеев при перемещении окна.
  Теперь и в движении они корректно скрываются.
- Последняя вкладка в макете получает достаточно времени загрузки перед включением split-screen.
- Все действия в диалоге выхода (кроме Отмена) теперь помечены как опасные кнопки (красные).
  «Отмена» остаётся нейтральной.
- Добавлена вкладка патчноутов в меню настроек.
  Отображается на выбранном языке.

### ➕ Новые функции

- Добавлена кнопка «+» в конце CD-таймера

### 🧹 Чистка

- Удалена неиспользуемая вкладка в диалоге иконок
- Удалён неиспользуемый бейдж «RM-EXP» в правом верхнем углу

---

## 🔄 Версия 2.1.0

### 🚀 Новое

- Обновления теперь можно выполнять прямо из лаунчера

---

## 🔄 Версия 2.0.2

### 🐛 Исправления

- Исправлена ошибка, из-за которой боковая панель была пустой
- Исправлены ошибки перевода
