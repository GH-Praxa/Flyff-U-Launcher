## Базовые функции

:::accordion[Создать профиль]

- Нажмите **«Новый профиль»** в шапке.

![Описание](create_profil/create_profil_1_ru.png)

- Введите имя профиля и нажмите **«Добавить»**.

![Описание](create_profil/create_profil_2_ru.png)

- Нажмите на значок шестерёнки, чтобы открыть настройки профиля.

![Описание](create_profil/create_profil_3_ru.png)

В этом меню можно:

- изменить имя профиля;
- выбрать класс (определяет эмблему профиля и может служить фильтром поиска);
- разрешить или запретить одновременное открытие нескольких копий профиля.

Если **«Использовать во вкладках»** включено, профиль можно открывать одновременно в нескольких вкладках; если выключено — только в одном окне.

Нужны оба варианта? Дублируйте профиль: одну копию с опцией включённой, другую без.  
Важно: единовременно можно использовать лишь один вариант каждого профиля.

![Описание](create_profil/create_profil_4_ru.png)

Можно создать сколько угодно профилей. У каждого своя сохранённая сессия Flyff.  
Настройки в игре не распространяются на другие сессии, как в браузере.
:::

:::accordion[Создать макет]

- В вкладке созданного профиля нажмите **«Играть»**. Убедитесь, что профиль разрешён для вкладок.  
![Описание](create_layout/create_layout_1_ru.png)

- Выберите нужную сетку макета.  
![Описание](create_layout/create_layout_3.png)

- Для каждой ячейки выберите профиль и нажмите **«Далее»**.  
![Описание](create_layout/create_layout_4_ru.png)

- Нажмите **«+»**, чтобы добавить ещё вкладки макетов.  
![Описание](create_layout/create_layout_5.png)

- Сохраните макет, чтобы запускать его из лаунчера.  
![Описание](create_layout/create_layout_6.png)  
![Описание](create_layout/create_layout_7.png)

- Вкладки можно переименовать правым кликом.
- Вкладки можно загружать последовательно или одновременно.  
  -> Настройки / Client Settings / Загружать grid-вкладки последовательно
:::

:::accordion[Пути данных и постоянство (Windows)]

Все пользовательские данные по умолчанию находятся в `%APPDATA%/Flyff-U-Launcher/` (Electron `userData`). Важные файлы/папки:

| Фича/файл                   | Назначение                                     | Путь относительно `%APPDATA%/Flyff-U-Launcher` |
|-----------------------------|------------------------------------------------|-----------------------------------------------|
| Данные и иконки API-Fetch   | Сырые данные/иконки для плагинов (предметы, монстры…) | `api_fetch/<endpoint>/...`                |
| Цены Premium Shopping List  | Цена FCoin за предмет                          | `item-prices.json`                            |
| Профили                     | Профили лаунчера (имя, класс, флаги)           | `profiles.json`                               |
| Макеты                      | Сетки макетов для вкладок                      | `tabLayouts.json`                             |
| Калибровки ROI              | ROI для OCR/Killfeed                           | `rois.json`                                   |
| Таймеры OCR                 | Частоты опроса OCR (Killfeed/CD-Timer)         | `ocr-timers.json`                             |
| Настройки плагинов          | Настройки по плагинам (killfeed, cd-timer и др.) | `plugin-data/<pluginId>/settings.json`      |
| Темы и цвет вкладок         | Пользовательские темы / цвет активной вкладки  | `themes.json`, `tabActiveColor.json`          |

:::

## Плагины

Плагинам обычно нужны данные и иконки из API. Скачайте их через API-Fetch.

:::accordion[API-Fetch]

- Откройте **«API-Fetch»**.  
![Описание](api_fetch/api_fetch_1.png)  
![Описание](api_fetch/api_fetch_2.png)

- Плагины ожидают данные API в конкретной папке. Проверьте, что она указана как выходная.  
![Описание](api_fetch/api_fetch_3.png)

- Выберите нужные endpoints и нажмите **«Start»**.  
![Описание](api_fetch/api_fetch_4.png)

:::

:::accordion[CD-Timer]
- Отслеживает перезарядки умений/предметов. По окончании таймера иконка с красной рамкой просит нажать заданную клавишу.
- Для показа иконок нужны API-Fetch: "Item" + "Skill".

- Убедитесь, что CD-Timer включён.  
![Описание](cd_timer/cd_timer_1_de.png)

- В боковой панели появится вкладка CD-Timer:
![Описание](cd_timer/cd_timer_2_de.png)
- "0/0 aktiv" показывает, сколько таймеров настроено и сколько активны.
- Checkbox "Alle aktiv" включает все таймеры.
- Кнопка "Alle abgelaufen" сбрасывает все таймеры на 0:00:00 и ждёт нажатия клавиши.

- Отображение иконок настраивается: позиция X/Y, размер, число колонок.

- Нажмите "+", чтобы создать новый таймер.

- ![Описание](cd_timer/cd_timer_3_de.png)
- Галочка активирует таймер.
- Кнопка "Icon" открывает диалог выбора иконки.
- Текст из поля будет показан на иконке. Совет: укажите ожидаемую клавишу, напр. "F1".
- После времени и хоткея выберите цель:  
  Main (иконка меча в лаунчере) или Support-view (иконка посоха).  
  Это определяет, в каком окне ждать нажатия. Иконка всегда показывается в окне Main.  
  Можно ставить таймеры для баффов RM и выводить напоминание в Main.


- ![Описание](cd_timer/cd_timer_4_de.png)

- Таймеры, нацеленные на Support, имеют оранжевое свечение.


- ![Описание](cd_timer/cd_timer_5_de.png)
:::

:::accordion[Killfeed]
- В реальном времени отслеживает киллы и EXP через OCR.
- Требуемый API-Fetch для данных монстров: "Monster".

**Возможности:**
- Обнаружение киллов по OCR (изменения EXP фиксируются автоматически)
- Статистика сессии и общая (киллы, EXP, киллы/час, EXP/час и т.д.)
- Overlay-бейджи прямо в окне игры

**Примечание:**
- Сейчас Killfeed поддерживает только кач 1v1.
- Планируется расширение на AOE и учёт киллов по группам/боссам.

**Настройка:**

1. **Если ещё нет: загрузите API-данные**
   - Откройте плагин [API-Fetch](action:openPlugin:api-fetch) и выберите endpoint **"Monster"**.
   - Запустите загрузку. Данные монстров нужны для проверки киллов по таблице EXP.  
     (см. документацию API-Fetch)
2. **Активируйте плагин**
   - В настройках плагинов лаунчера включите **Killfeed**.  
   ![Описание](killfeed/killfeed_1_de.png)

3. **Калибруйте области OCR** (один раз на профиль)
   - Запустите игровое окно через лаунчер с активной «кнопкой меча».  
    ![Описание](killfeed/killfeed_2_de.png)
   - В боковой панели откройте калибровку ROI.
   - Обведите области:
     - **EXP%** – индикатор опыта
     - **Level** – уровень
     - **Character name** – имя персонажа
   - Сохраните области. Они хранятся на профиль и задаются один раз.  
    ![Описание](killfeed/killfeed_3_de.png)
   - ЛКМ перетаскивает ROI.
   - После установки ROI можно нажать TAB для выбора следующего.  
    ![Описание](killfeed/killfeed_4_de.png)
   - Для Killfeed задайте: LVL, NAME, EXP, ENEMY (уровень врага), ENEMY HP
   - Нажмите «Schließen» или ESC, чтобы завершить.  
    ![Описание](killfeed/killfeed_5_de.png)
   - ROI можно донастроить после рисования.  
    ![Описание](killfeed/killfeed_6_de.png)
   - Распознанные значения видны в реальном времени в панели.
   - Главное — LVL и EXP; ENEMY и ENEMY HP пока вспомогательные, важнее в будущем.
   - Если уровень в OCR неправильный, выставьте вручную — ручное значение приоритетнее OCR.
   - Если OCR «проглотил» EXP (напр., при смене персонажа), задайте его вручную;  
     правила EXP могут помешать автоисправлению.
   - ![Описание](killfeed/killfeed_7_de.png)


4. **Выберите профиль в боковой панели**
   - Откройте вкладку **Killfeed**.
   - В выпадающем списке выберите профиль для отслеживания.  
    ![Описание](killfeed/killfeed_8_de.png)


5. **Играйте**
   - При убийстве монстров OCR фиксирует изменения EXP.
   - Киллы и статистика автоматически выводятся в overlay и боковой панели.

**Боковая панель:**
- Включайте/выключайте отдельные бейджи (Киллы/сессия, EXP/час, Киллов до апа и др.).
![Описание](killfeed/killfeed_9_de.png)
- Масштаб overlay (0.6x–1.6x).
- Количество строк для бейджей.
![Описание](killfeed/killfeed_10_de.png)
- Сброс статистики сессии кнопкой Reset.
- Данные каждой сессии сохраняются локально.

![Описание](killfeed/killfeed_11_de.png)

- Каждый обнаруженный килл отображается в сайдпанели и сохраняется постоянно.
- Сохранение выполняется по профилю в CSV-файлы в AppData:
  - `user/plugin-data/killfeed/history/<profile-id>/daily/YYYY-MM-DD.csv` (отдельные киллы)
  - `user/plugin-data/killfeed/history/<profile-id>/history.csv` (дневная сводка)
- В аккордеонах отслеживания монстров для каждого ранга доступна кнопка `Kills`.
- `Kills` открывает список отдельных киллов выбранного ранга.

![Описание](killfeed/killfeed_12_de.png)

- В списке можно удалять отдельные киллы (`Delete` -> `Confirm`).
- При удалении сразу обновляются отображение в сайдпанели и файлы истории Killfeed (`daily/YYYY-MM-DD.csv` и `history.csv`).

![Описание](killfeed/killfeed_13_de.png)


**Правила засчёта килла:**
Килл считается, если выполнено всё:
- Уровень не изменился (нет lvl-up/down).
- EXP выросло более чем на 0.001% (эпсилон).
- Прыжок EXP не более 40% (suspect-порог); выше — помечается подозрительным и отбрасывается.
- За последние 1500 мс обнаружена полоска HP врага (OCR). Без полоски: допускается, если прошло ≥2250 мс с последнего килла.
- Если есть данные монстров из API-Fetch: прирост EXP между 10% и 10× ожидаемого по таблице; вне диапазона — ошибка OCR.

**Отклоняемые изменения EXP:**
- Level-up/down: килл не считается.
- EXP уменьшилось: игнорируется (шум OCR).
- Прыжок EXP > 40%: помечается подозрительным, не считается.
- Нет полоски HP и <2250 мс с последнего килла: не считается.

**Примечания:**
- OCR должен быть активен, иначе киллы не определяются.
- Статы вроде киллов/час рассчитываются по скользящему окну 5 минут.
:::

:::accordion[Killfeed: Giant Tracker]
# ВНИМАНИЕ:
## До первого зафиксированного убийства Giant, Violet или Boss показываются примерные данные для демонстрации функции.
---
Giant Tracker — отдельное окно внутри плагина Killfeed. Оно отслеживает и визуализирует статистику убийств **Giants**, **Violets** и **Bosses** — включая временные периоды, дропы и Time to Kill (TTK). Пять вкладок-фильтров (Все, Giants, Violets, Bosses, Drops) позволяют целенаправленно фильтровать по рангу или по зарегистрированным дропам.

**Открытие:**
- Кнопка **«Giant Tracker»** находится в боковой панели Killfeed.
- Клик открывает отдельное окно с обзором всех отслеживаемых боссов.
- Если реальных данных об убийствах ещё нет, отображаются примерные данные.

![Описание](killfeed_giant_tracker/killfeed_giant_tracker_1_de.png)

---

**Фильтрация и сортировка:**
- Панель фильтров позволяет ограничить отображение:
  - **Все** / **Giants** / **Violets** / **Bosses** / **Drops** — фильтрация по рангу монстра или дропам.
  - **Bosses** — показывает только монстров с рангом `boss` (напр. Clockworks, Meteonyker). Карточки боссов имеют красную рамку.
  - **Drops** — показывает только монстров с хотя бы одним зарегистрированным дропом. Дополнительно в карточке отображается превью лут-пула (топ-5 предметов по редкости).
  - **Сортировка** — по убийствам (по возрастанию/убыванию), имени (A–Z / Z–A) или уровню (по возрастанию/убыванию).
  - **Поле поиска** — фильтрует карточки по имени монстра.

![Описание](killfeed_giant_tracker/killfeed_giant_tracker_2_de.png)

---

**Виды карточек:**

Каждый отслеживаемый монстр отображается как карточка. Доступны два вида:

*Компактная карточка (вид по умолчанию):*
- Иконка монстра, имя, уровень, стихия, ранг
- Боевые характеристики (HP, ATK)
- Обзор убийств: Сегодня / Всего
- Отображение TTK (при наличии данных): `TTK: 45.2s (Ср 52.3s)`
- Последнее убийство (время), количество дропов
- Кнопка **«Подробнее»** для раскрытия

![Описание](killfeed_giant_tracker/killfeed_giant_tracker_3_de.png)

*Развёрнутая карточка (подробный вид):*
- Все поля компактной карточки
- Статистика убийств по периодам: Сегодня, Неделя, Месяц, Год, Всего
- Статистика TTK: Ср. TTK, Последний TTK, Быстрейший
- Раздел дропов: Количество дропов, ср. убийств на дроп, убийства с последнего дропа
- История дропов (сворачиваемая): Отдельные дропы с названием предмета, счётчиком убийств и временной меткой
- Кнопка **«Добавить дроп»** для записи дропа
- Кнопка **«Свернуть»** для закрытия подробного вида

![Описание](killfeed_giant_tracker/killfeed_giant_tracker_4_de.png)

---

**Отслеживание дропов:**

Кнопка **«Добавить дроп»** в развёрнутой карточке открывает диалог:
- Показывает лут-пул монстра (если данные загружены через API-Fetch).
- Предметы можно искать по имени и фильтровать по редкости (Обычный, Необычный, Редкий, Очень редкий, Уникальный, Ультимативный).
- Клик по предмету регистрирует дроп с текущей временной меткой и счётчиком убийств.
- Ранее зарегистрированные дропы можно удалять по отдельности из истории.

![Описание](killfeed_giant_tracker/killfeed_giant_tracker_5_de.png)
![Описание](killfeed_giant_tracker/killfeed_giant_tracker_6_de.png)

---

**Time to Kill (TTK):**

TTK автоматически измеряет длительность боя с боссом — от первого удара до убийства.

*Принцип работы:*
- **Старт:** Полоса HP врага обнаружена с `текущее < макс` (бой начался).
- **Стоп:** Убийство подтверждено через определение EXP. Накопленное время боя сохраняется.
- **Пауза:** Полоса HP исчезает (напр. при снятии цели для баффа или лечения). Начинается льготный период в 10 секунд.
- **Возобновление:** Если тот же босс выбран повторно в течение 10 секунд, таймер продолжается. Время паузы не засчитывается в TTK.
- **Отмена:** Если льготный период истекает без повторного выбора босса, измерение TTK отбрасывается.

*Идентификация цели:*
- В начале боя сохраняются имя монстра и максимальные HP.
- При повторном выборе сравниваются имя и макс. HP — таймер возобновляется только при совпадении.
- Если выбран другой босс, текущее измерение прерывается и начинается новое.
- Если выбран обычный монстр, таймер босса ставится на паузу; обычные убийства продолжают считаться.

*Отображение и статистика:*
- Компактная карточка: `TTK: [последнее убийство] (Ср [среднее])`
- Развёрнутая карточка: Ср. TTK, Последний TTK, Быстрейший
- Значения TTK сохраняются покилльно в CSV-истории (столбец `TTK_ms`) и агрегируются по монстру.

*Ограничение:*
- Измерение TTK активно только для Giants, Violets и Bosses. Обычные монстры не измеряются.
- Точность зависит от частоты сканирования OCR (обычно: каждые 500–1000 мс).

---

**Источники данных:**
- Данные об убийствах берутся из CSV-истории Killfeed (`daily/YYYY-MM-DD.csv`).
- Логи дропов хранятся отдельно по профилю.
- Детали монстров (иконка, HP, ATK, лут-пул) берутся из данных, загруженных через API-Fetch.

:::

## Инструменты

Инструменты открываются хоткеем или через звездочку в панели вкладок.

:::accordion[Fcoin <-> Penya]

![Описание](tools/fcoin_zu_penya/fcoin_zu_penya_1.png)
- Конвертирует FCoins в Penya и обратно.
- Введите текущий курс Penya за FCoin. Курс сохраняется и загружается автоматически.
- Меняйте сумму FCoins или результат в Penya — перерасчёт идёт в обе стороны.

![Описание](tools/fcoin_zu_penya/fcoin_zu_penya_2.png)

:::

:::accordion[Премиум список покупок]
- Планирование покупок в Премиум-магазине; помогает оценить потребность перед покупкой FCoins. Требуются разрешённые всплывающие окна.
- Требования: endpoint API-Fetch **"Item"** с иконками; без этих данных поиск пуст.
![Описание](tools/premium_shopping_list/premium_shopping_list_1.png)
- Использование:
  1. Откройте инструмент в меню со звездой и введите название предмета.
  2. Список (до 20 результатов) покажет иконку, имя, категорию; добавьте через **"+ Add"** или увеличьте количество.  
  ![Описание](tools/premium_shopping_list/premium_shopping_list_2.png)
  3. В списке задайте цену (FCoins) и количество; цена сохраняется при выходе из поля и подставляется позже.
  4. Checkbox отмечает купленные/готовые предметы, "X" удаляет строку.
  5. Нижняя полоса показывает сумму (`цена × количество`) в FCoins.
- Хранение: цены сохраняются в папке данных лаунчера (`%APPDATA%/Flyff-U-Launcher/item-prices.json`); сам список обнуляется по каждой сессии.

:::
